# ADR-0001: Web Framework for go-backend

Date: 2026-02-15  
Status: Accepted

---

## Context
go-backend の HTTP API 実装において、Web フレームワークの選定が必要となった。

### Background
- 本リポジトリでは `go-backend/` を API サービスの実装モジュールとして運用する。
- 初期フェーズでは、開発速度と保守性を両立できる構成が必要。
- チーム開発を前提として、学習コストと実装の一貫性を抑えたい。

### Scope
- 対象: `go-backend` のアプリケーション HTTP 層（ルーティング、ハンドリング、ミドルウェア連携）。
- 対象外: リバースプロキシや API Gateway の製品選定。

### Constraints
- 標準的な HTTP ミドルウェア（ロギング、リカバリ、認証、CORS）を扱えること。
- テストしやすい構造を取りやすいこと。
- 過度な抽象化や独自拡張を前提としないこと。
- 将来的に gRPC を追加しても、ビジネスロジック層を再利用しやすいこと。

## Decision
`go-backend` の Web フレームワークとして **Echo** を採用する。

運用ルール:
- ルーティングは Echo の Router を使用する。
- 共通処理（ロギング、リカバリ、CORS、認証など）はミドルウェアとして集約する。
- ビジネスロジックはフレームワーク依存を最小化し、ハンドラ層に閉じ込める。
- 新規 API は Echo ベースで実装し、別フレームワークは導入しない。

## Options

### Option A: gin
- 概要
  - 高速かつ広く利用される Go の Web フレームワーク。
- Pros
  - 実績が多く、参考情報やサンプルが豊富。
  - ルーティングやバリデーション周辺の実装パターンが定着している。
- Cons
  - `gin.Context` への依存が強くなりやすく、層分離を意識しないと密結合になりやすい。
  - 本プロジェクトで想定する API 規模に対しては、Echo と優位差が決定打にならない。
- 想定ユースケース / 制約
  - 大規模に gin の知見が既にあるチーム、または既存 gin サービスとの統一が最優先のケース。

### Option B: echo
- 概要
  - 軽量でミドルウェア構成が明確な Go の Web フレームワーク。
- Pros
  - ルーティングとミドルウェアの記述が簡潔で、初期開発速度を確保しやすい。
  - 必要十分な機能を持ちつつ、構成をシンプルに保ちやすい。
  - 小〜中規模 API で運用しやすく、保守時の見通しが良い。
- Cons
  - 標準ライブラリ直書きよりはフレームワーク依存が発生する。
  - チームメンバーによっては gin より学習資産が少ない可能性がある。
- 想定ユースケース / 制約
  - 迅速な立ち上げと保守性の両立を重視する API バックエンド。

### Option C: net/http
- 概要
  - Go 標準ライブラリのみで HTTP サーバを構築する。
- Pros
  - 外部依存が最小で、挙動の透明性が高い。
  - フレームワーク固有 API へのロックインを避けやすい。
- Cons
  - ルーティングや共通ミドルウェアを自前で整備する必要があり、初期実装コストが高い。
  - 実装方針がチーム内でばらつきやすく、規約整備コストが増える。
- 想定ユースケース / 制約
  - 超軽量要件、またはフレームワーク依存を厳格に避けたいケース。

## Rationale
最終的に重視した判断軸は、以下の 3 点。

- 立ち上げ速度（API を早く形にできること）
- 保守性（ミドルウェアやルーティングの見通し）
- 依存コスト（過度な抽象化や自前実装を避けること）
- 拡張性（将来的な gRPC 追加時に責務分離を維持しやすいこと）

`net/http` は依存最小という利点がある一方、現時点の開発フェーズでは自前実装コストが高い。`gin` は有力だが、本プロジェクトで必要な要件に対しては `echo` で十分に満たせる。さらに、HTTP ハンドラへの依存を境界に閉じ込める運用ルールと組み合わせることで、将来的な gRPC 追加時にもドメイン/ユースケース層の再利用性を確保しやすい。結果として、速度・簡潔さ・保守性・拡張性のバランスが最も良い `echo` を採用する。

## Consequences
- Positive
  - 初期開発を迅速に進められる。
  - ルーティング・ミドルウェア構成を統一しやすい。
  - ハンドラ境界を保てば、将来的な差し替え余地も一定確保できる。

- Negative
  - Echo 依存の API（`echo.Context` など）を無制限に広げると、移行コストが増える。
  - チームで Echo の実装規約を持たない場合、書き方が散らばる可能性がある。

- Migration / Follow-up
  - `go-backend` に実装規約（ハンドラ責務、ミドルウェア配置、エラーハンドリング）を定義する。
  - 新規エンドポイント追加時に、フレームワーク依存がドメイン層へ漏れていないかレビューする。
  - 将来 gRPC を導入する場合は、HTTP と gRPC でユースケース層を共有する構成を前提に ADR を追加する。

## References
- Echo: https://echo.labstack.com/
- Gin: https://gin-gonic.com/
- Go `net/http`: https://pkg.go.dev/net/http
